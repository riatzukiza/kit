
(include "../deps")

(import-namespace defs)
(import-namespace js)

(const (literal create extend mixin)
       (require "./util"))

(const (literal File) (require "./file-system"))
(const (literal Future) (require "./async"))
(const (literal Unit) (require "./unit"))

(type Javascript

      (init (string))

      (gmth make-pretty () )
      (gmth validate ())

      (gmth eval (string)
            "Evaluate as javascript the string contained with in this container"
            (pipe (.resolve Future string)
                  (then s (print "string?" s) s)
                  (.then  vm.run-in-this-context )))

      (generic update (fluent mth) (value)
               (assign this.string value)
               this)
      (gmth save (target) (assign target.string this.string))
      (gmth save-file (path) (this.save ((create File) path)))
      (gmth compile ())

      (gmth load (source  (js source.js))
            "return a unit useing the string of this container as its source"
            ((create Unit) string)))

(export Javascript)
